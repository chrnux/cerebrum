##
## Makefile for Cereweb
##

prefix = @prefix@
exec_prefix = @exec_prefix@
INSTALL = @INSTALL@
CONFDIR = @CONFDIR@
SBINDIR = @sbindir@
WEBROOT = @webroot@

.PHONY: all clean distclean

config_files = $(basename $(wildcard *.conf.template))

all: config.py
	$(MAKE) -C htdocs $@
	$(MAKE) -C lib $@

install: install-lib
	$(MAKE) -C htdocs $@
	$(MAKE) -C lib $@

%.conf: %.conf.template
	$(INSTALL) -v -m 644 $< $@

config.py: config.py.in
	sed 's,#CONFDIR#,${CONFDIR},' $< > $@

install-lib: $(config_files) config.py
	$(INSTALL) -d $(CONFDIR)/
	$(INSTALL) -v -m 644 $^ $(CONFDIR)/
	$(INSTALL) -v -m 755 cereweb.py ${SBINDIR}/
	$(INSTALL) -d ${WEBROOT}/
	$(INSTALL) -v -m 644 config.py $(WEBROOT)/

clean:
	$(MAKE) -C htdocs $@
	$(MAKE) -C lib $@

distclean: clean
	$(MAKE) -C htdocs $@
	$(MAKE) -C lib $@

