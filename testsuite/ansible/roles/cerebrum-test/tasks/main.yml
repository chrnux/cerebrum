# This is the main file for setting up a remote host
#

- set_fact: virtualenv=/tmp/virtualenvs/{{ config | default('default')  }}
  tags:
    - always
  
- set_fact: crb_db_name="testdb_{{ config | default('default') }}"
  tags:
    - always

- set_fact: gnupg_home_dir=/tmp/gnupghomes/{{ config | default('default') }}/.gnupg
  tags:
    - always

- debug: var=config
  tags:
    - debug

- debug: var=virtualenv
  tags:
    - debug

- debug: var=crb_db_name
  tags:
    - debug
  
# To set up ident authentication for a different set of users, we should
# overload the system_users variable in the top playbook.
- include: setup_host.yml
  vars:
    system_users: []
  tags:
    - host

# To set up a different database schema, we should overload the crb_extra_files
# in the top playbook.
- include: setup_env.yml
  tags:
    - env


# To run with other tests, we should overload the crb_tests in the top playbook
# file. The same goes for the report files.
- include: run_nosetests.yml
  vars:
    coverage_report: "{{ config }}_coverage.xml"
    xunit_report: "{{ config }}_xunit.xml"
  tags:
    - test
    - nose

# Some testing. Could we do a conditional import of variables, and import good
# default values from ../vars/<config>.yml?
#- include: test.yml
  #vars_files:
    #- "../vars/common.yml"
    #- "../vars/test.yml"
    #- "../vars/doesntexist.yml"
