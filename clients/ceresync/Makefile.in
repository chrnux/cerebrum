##
## Makefile for SpineClient
##

INSTALL = @INSTALL@
pythondir = @PYTHONDIR@
prefix = @prefix@
exec_prefix = @exec_prefix@
SBINDIR = @sbindir@

.PHONY: all install install-lib clean distclean

progs = syncfile.py syncldap.py synckerberos.py syncadsi.py syncradius.py syncnothing.py synchomedir.py syncaliases.py syncadsi.bat
backend = backend/file.py backend/ldapbackend.py backend/__init__.py backend/test.py
adsibackend = backend/adsi/__init__.py backend/adsi/active_directory.py backend/adsi/ad_types.py backend/adsi/ad_errors.py backend/adsi/wrapper.py
kerberosbackend = backend/kerberos/__init__.py backend/kerberos/kadm5.py backend/kerberos/heimdal_error.py backend/kerberos/mit_error.py
common = cerelog.py config.py doc_exception.py errors.py syncws.py __init__.py

cerews = cerews_services.py cerews_services_types.py
deps = ../../servers/cerews/lib/dom.py ../../servers/cerews/lib/SignatureHandler.py

all: $(cerews)

$(cerews): ../../servers/cerews/lib/cerews.wsdl
	wsdl2py -f $<

install: $(cerews) install-lib
	$(INSTALL) -d "$(SBINDIR)"
	$(INSTALL) -m 755 $(progs) "$(SBINDIR)/"


install-lib: 
	$(INSTALL) -d "$(pythondir)/ceresync"
	$(INSTALL) -m 644 $(common)  "$(pythondir)/ceresync"
	$(INSTALL) -d "$(pythondir)/ceresync/backend"
	$(INSTALL) -d "$(pythondir)/ceresync/backend/kerberos"
	$(INSTALL) -d "$(pythondir)/ceresync/backend/adsi"
	$(INSTALL) -m 644 $(backend)  "$(pythondir)/ceresync/backend"
	$(INSTALL) -m 644 $(kerberosbackend)  "$(pythondir)/ceresync/backend/kerberos"
	$(INSTALL) -m 644 $(adsibackend)  "$(pythondir)/ceresync/backend/adsi"
	$(INSTALL) -m 644 $(cerews) "$(pythondir)/ceresync"
	$(INSTALL) -m 644 $(deps) "$(pythondir)/ceresync"

clean:
	-rm $(cerews)

distclean: clean

