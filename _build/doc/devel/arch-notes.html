

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setting up a dev branch for Cerebrum: &mdash; Cerebrum 0.9.16 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.9.16',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Cerebrum 0.9.16 documentation" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">Cerebrum 0.9.16 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="setting-up-a-dev-branch-for-cerebrum">
<h1>Setting up a dev branch for Cerebrum:<a class="headerlink" href="#setting-up-a-dev-branch-for-cerebrum" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction:<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This recipe is for setting up arch for working with Cerebrum. If you have a
cvs tree, you can keep it; the main idea is to create your own branch of the
&#8220;main&#8221; archive and set up the necessary synchronization procedures.</p>
<p>A friendly advice is in order &#8211; arch has a rather steep learning curve. Until
you commit for the first time (and your commit ends up in the main cerebrum
archive), do not create huge changes. Get a feeling for what it means to work
with arch, but in such a way that you could potentially start over from
scratch, should you get completely lost in the setup and would like to just
erase everything.</p>
<p>This guide assumes that you are familiar with a number of arch concepts (take
a peek at &#8220;hello world meets arch&#8221; for a detailed introduction. &lt;URL:
<a class="reference external" href="http://www.gnu.org/software/gnu-arch/tutorial/arch.html">http://www.gnu.org/software/gnu-arch/tutorial/arch.html</a>&gt;).</p>
<p>At USIT we will assume this workflow structure: there is a &#8220;main&#8221; Cerebrum
archive. It is the &#8220;official&#8221; repository and it serves as a basis for releases
and there are very few people who can commit to that archive. That archive is
also synchronized against CVS (for as long as CVS exists). The naming scheme
looks thus:</p>
<p>main archive                    <a class="reference external" href="mailto:cerebrum&#37;&#52;&#48;usit&#46;uio&#46;no--2004">cerebrum<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no--2004</a>
category in the main archive    Cerebrum
branch in that category         Cerebrum&#8211;cvs
version in that branch          Cerebrum&#8211;cvs&#8211;0</p>
<p>So the fully qualified name of the official version is:</p>
<div class="highlight-python"><pre>cerebrum@usit.uio.no--2004/Cerebrum--cvs--0
[      archive           ]
                           [category]
                           [       branch]
                           [         version]</pre>
</div>
<p>We will set up an archive called <a class="reference external" href="mailto:'ivr&#37;&#52;&#48;usit&#46;uio&#46;no">'ivr<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no</a>&#8216; that has only read-only
access to the &#8220;main&#8221; archive. This archive would have a version for cerebrum
development (it can have many) called Cerebrum&#8211;ivr&#8211;1.0 (i.e. the archive
<a class="reference external" href="mailto:'ivr&#37;&#52;&#48;usit&#46;uio&#46;no">'ivr<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no</a>&#8216; will have a <em>category</em> &#8220;Cerebrum&#8221;, a branch in that category
called &#8220;Cerebrum&#8211;ivr&#8221;, and a version of that branch called
Cerebrum&#8211;ivr&#8211;1.0).</p>
<p>Graphically (the arrows show the directions in which the changes flow):</p>
<div class="highlight-python"><pre>cerebrum@usit.uio.no--2004/   Every 12 min      cvs.sf.net:/cvsroot/cerebrum
     Cerebrum--cvs--0       &lt;--------------&gt;           (cvs head)
            ^  |
            |  +-----------------+
            |                    |
            +---------------+    |
                            |    |
                            |    |
                            |    |
                            |    |
 hmeland@usit.uio.no--2004/ |    |       ivr@usit.uio.no/
 Cerebrum--doc--1.0         |    +----&gt; Cerebrum--ivr--1.0
 [     version    ]         |           [    version     ]
                            |
 Cerebrum--main--1.0 &lt;------+
 [     version     ]</pre>
</div>
<p>Please note that arch has really no concept of a &#8220;main archive&#8221; (i.e. arch has
no concept corresponding directly to &#8220;repository&#8221; in cvs). As more developers
move to arch, it will make sense for &#8220;<a class="reference external" href="mailto:ivr&#37;&#52;&#48;usit&#46;uio&#46;no/Cerebrum--ivr--1&#46;0">ivr<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no/Cerebrum--ivr--1<span>&#46;</span>0</a>&#8221; to
merge in changes from other people&#8217;s versions.</p>
</div>
<div class="section" id="setup">
<h2>Setup:<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Create your id:</p>
<p>The standard naming scheme is &#8220;name &lt;e-mail&gt;&#8221;:</p>
<div class="highlight-python"><pre>tla my-id 'Igor V Rafienko &lt;ivr@usit.uio.no&gt;'</pre>
</div>
</li>
<li><p class="first">Create <em>your</em> archive:</p>
<div class="highlight-python"><pre>mkdir ~/arch
tla make-archive 'ivr@usit.uio.no' ~/arch/ivr@usit.uio.no
tla my-default-archive 'ivr@usit.uio.no'</pre>
</div>
<p>The last step is not necessary, but it makes tla commands less verbose.</p>
</li>
<li><p class="first">Register other archives:</p>
<p>Not all of this is necessary, but you should at least register the &#8220;main&#8221;
cerebrum arch archive (the one that is regularily sync&#8217;ed against CVS):</p>
<div class="highlight-python"><pre>tla register-archive \
  'http://www.cerebrum.usit.uio.no/archive/cerebrum@usit.uio.no--2004'
  -&gt; Registering archive: cerebrum@usit.uio.no--2004

tla register-archive \
  'http://folk.uio.no/hmeland/archives/hmeland@usit.uio.no--2004'
  -&gt; Registering archive: hmeland@usit.uio.no--2004</pre>
</div>
<p>Note that these archives are read-only &#8211; you will be able to fetch
patchsets _from_ these archives, but you will not be able to commit your
changes to them. More on this later.</p>
</li>
<li><p class="first">Set up your archive:</p>
<p>Now you should create your Cerebrum project. In arch terminology you would
be creating a branch. You can call it whatever you want (that is, both
category, branch and version parts), but you should really stick
to some sensible naming scheme:</p>
<div class="highlight-python"><pre>tla archive-setup Cerebrum--ivr--1.0
-&gt; creating category ivr@usit.uio.no/Cerebrum
-&gt; creating branch ivr@usit.uio.no/Cerebrum--ivr
-&gt; creating version ivr@usit.uio.no/Cerebrum--ivr--1.0</pre>
</div>
</li>
<li><p class="first">Set up your branch:</p>
<p>It makes sense to branch off from the latest revision of the main version
(it is the easiest way). Note, that it will take quite some time to apply
all the patchsets:</p>
<div class="highlight-python"><pre>tla tag cerebrum@usit.uio.no--2004/Cerebrum--cvs--0 Cerebrum--ivr--1.0
-&gt; Archive caching revision
-&gt; from import revision: cerebrum@usit.uio.no--2004/Cerebrum--cvs--0--base-0
-&gt; patching for revision: cerebrum@usit.uio.no--2004/Cerebrum--cvs--0--patch-1
-&gt; patching for revision: cerebrum@usit.uio.no--2004/Cerebrum--cvs--0--patch-2
[ ... ]
-&gt; patching for revision: cerebrum@usit.uio.no--2004/Cerebrum--cvs--0--patch-276
-&gt; patching for revision: ivr@usit.uio.no/Cerebrum--ivr--1.0--base-0
-&gt; Made cached revision of  ivr@usit.uio.no/Cerebrum--ivr--1.0--base-0</pre>
</div>
<p>NB! At this point <em>nothing</em> has been committed to the <a class="reference external" href="mailto:'ivr&#37;&#52;&#48;usit&#46;uio&#46;no">'ivr<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no</a>&#8216;
archive. We will do this later.</p>
<p>Actually, setting of the branch and archive creation can be performed in one
go:</p>
<div class="highlight-python"><pre>tla tag --setup cerebrum@usit.uio.no--2004/Cerebrum--cvs--0 \
                Cerebrum--ivr--1.0</pre>
</div>
<p>(&#8211;setup tells tag to use archive-setup, if necessary).</p>
</li>
<li><p class="first">Fetch the code:</p>
<div class="highlight-python"><pre>tla get Cerebrum--ivr--1.0 ~/work/cerebrum-arch
-&gt; from archive cached: ivr@usit.uio.no/Cerebrum--ivr--1.0--base-0
-&gt; making pristine copy
-&gt; tree version set ivr@usit.uio.no/Cerebrum--ivr--1.0</pre>
</div>
<p>Now we have the source tree:</p>
<div class="highlight-python"><pre>cd ~/work/cerebrum-arch</pre>
</div>
</li>
<li><p class="first">Explore the code:</p>
<p>This part is optional, but it should give you a feeling of &#8220;what&#8217;s inside&#8221;</p>
<div class="highlight-python"><pre>tla logs -Dsc cerebrum@usit.uio.no--2004/Cerebrum--cvs--0
-&gt; [ ... bunch of logs, mostly "Update from CVS" ]</pre>
</div>
<p>NB! These are the logs from <a class="reference external" href="mailto:ivr&#37;&#52;&#48;usit&#46;uio&#46;no">ivr<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no</a> archive (they should be
identical to Cerebrum&#8211;cvs&#8211;0 up to the tagged version, though)</p>
</li>
<li><p class="first">First commit:</p>
<p>Do <em>NOT</em> introduce any local changes before this commit.</p>
<p>Now, the code has been fetched from the main version and dumped into ivr&#8217;s
local project tree (~/work/cerebrum-arch). But the code has not yet been
committed to the <a class="reference external" href="mailto:ivr&#37;&#52;&#48;cerebrum&#46;uio&#46;no">ivr<span>&#64;</span>cerebrum<span>&#46;</span>uio<span>&#46;</span>no</a> archive.</p>
<div class="highlight-python"><pre>cd ~/work/cerebrum-arch
tla make-log
(fiddle with the log)
tla commit</pre>
</div>
<p>The basic setup is finished.</p>
</li>
</ul>
</div>
<div class="section" id="development-cycle">
<h2>Development cycle:<a class="headerlink" href="#development-cycle" title="Permalink to this headline">¶</a></h2>
<p>Now we are all done and ready to start with our changes. Merges between
different revisions can look something like this:</p>
<div class="highlight-python"><pre>Cerebrum--cvs--0              Cerebrum--ivr--1.0
       |                             |
    base-0           +----------&gt; base-0
       |            /                |
    atch-1         /              patch-1
       |          /                  |
      ...        /                  ...
    patch-276 --+    +----------&gt; patch-10
      ...           /                |
    patch-293 -----+                ...
      ...</pre>
</div>
<p>I.e. every now and then[1] new code is merged to Cerebrum&#8211;ivr&#8211;1.0 from the
main version.</p>
<p><em>IS IS VERY IMPORTANT</em> that you stick to these two rules:</p>
<blockquote>
<div><ul class="simple">
<li>Do <em>NOT</em> merge from Cerebrum&#8211;cvs&#8211;0 (or any other version) into your
version (project tree?) when you have your own (local) uncomitted
changes. Mixing local and merged changes in your revision will make life
miserable for those who try to merge changes from your version. &#8220;tla
changes&#8221; might be helpful here.</li>
<li><em>Always</em> commit (to your archive) the changes that you have merged from
other versions <em>BEFORE</em> starting work on your own changes.</li>
</ul>
</div></blockquote>
<p>Now, let&#8217;s change some code. The changes are:</p>
<div class="highlight-python"><pre>tla changes
-&gt; looking for ivr@usit.uio.no/Cerebrum--ivr--1.0--base-0 to compare with
-&gt; comparing to ivr@usit.uio.no/Cerebrum--ivr--1.0--base-0
-&gt; M  Cerebrum/modules/no/hia/mod_sap.py</pre>
</div>
<p>Let&#8217;s go and commit. The first step is writing a log:</p>
<div class="highlight-python"><pre>tla make-log
-&gt; /hom/ivr/jobb/cerebrum-arch/++log.Cerebrum--ivr--1.0--ivr@usit.uio.no</pre>
</div>
<p>Now I edit the log (emacs, vi, whatever) and I am ready to commit to my
archive:</p>
<div class="highlight-python"><pre>tla commit
-&gt; M  Cerebrum/modules/no/hia/mod_sap.py
-&gt; update pristine tree
   (ivr@usit.uio.no/Cerebrum--ivr--1.0--base-0 -&gt; Cerebrum--ivr--1.0--patch-1)
-&gt; committed ivr@usit.uio.no/Cerebrum--ivr--1.0--patch-1</pre>
</div>
<p>So, now Cerebrum&#8211;ivr&#8211;1.0 in the <a class="reference external" href="mailto:ivr&#37;&#52;&#48;usit&#46;uio&#46;no">ivr<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no</a> archive contains a merging
of Cerebrum&#8211;cvs&#8211;0 as per patch-276 and the changes in mod_sap.py:</p>
<div class="highlight-python"><pre>tla revisions --summary
-&gt; base-0
-&gt;    tag of cerebrum@usit.uio.no--2004/Cerebrum--cvs--0--patch-276
-&gt; patch-1
-&gt;    Attribute renaming in PersonSAPMixin</pre>
</div>
<p>However, the main version has no Cerebrum&#8211;ivr&#8211;1.0&#8211;patch-1. When I feel
confident enough that it will not break anything, I can can report the changes
to whoever has commit rights to <a class="reference external" href="mailto:cerebrum&#37;&#52;&#48;usit&#46;uio&#46;no--2004/Cerebrum--cvs--0">cerebrum<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no--2004/Cerebrum--cvs--0</a>
and ask them to merge my changes in.</p>
<p>The next day (BEFORE I start making any changes), I might want to catch up
with the main version:</p>
<div class="highlight-python"><pre>tla changes
-&gt; [ no output ]</pre>
</div>
<p>Aha, no local changes since last commit. This is good. What new patches have
arrived to the main version since I last merged from it:</p>
<div class="highlight-python"><pre>tla missing cerebrum@usit.uio.no--2004/Cerebrum--cvs--0
-&gt; patch-???
-&gt; patch-???
   ...
-&gt; patch-???</pre>
</div>
<p>Ok, so someone changed some code. Let&#8217;s look at the changes:</p>
<div class="highlight-python"><pre>tla cat-archive-log cerebrum@usit.uio.no--2004/Cerebrum--cvs--0--patch-???
-&gt; [ ... ]</pre>
</div>
<p>The changes are interesting, let us merge them into my project tree:</p>
<div class="highlight-python"><pre>tla star-merge cerebrum@usit.uio.no--2004/Cerebrum--cvs--0</pre>
</div>
<p>Note, it is possible to merge only _some_ of the patchsets, but this might not
be very easy or very wise...</p>
<p>Now, in order for the &#8220;missing&#8221; changes to be available from <a class="reference external" href="mailto:ivr&#37;&#52;&#48;usit&#46;uio&#46;no">ivr<span>&#64;</span>usit<span>&#46;</span>uio<span>&#46;</span>no</a>,
we have to commit the result of the star-merge. Or, equally important, before
I can start making local changes, I <em>must</em> commit the merged changes (from the
main version).</p>
</div>
<div class="section" id="opening-your-work-to-other-cerebrum-devs">
<h2>Opening your work to other cerebrum devs:<a class="headerlink" href="#opening-your-work-to-other-cerebrum-devs" title="Permalink to this headline">¶</a></h2>
<p>In two words &#8211; mirroring archives.</p>
<p>&lt;URL: <a class="reference external" href="http://wiki.gnuarch.org/moin.cgi/mini_5fMirroringArchives">http://wiki.gnuarch.org/moin.cgi/mini_5fMirroringArchives</a>&gt;</p>
<p>[1] Please note that this synchronization is up to each developer. Some people
like to sync at the start of each work day, other do not. Sometimes it does
not make sense to sync because of the scope of changes in one&#8217;s code.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setting up a dev branch for Cerebrum:</a><ul>
<li><a class="reference internal" href="#introduction">Introduction:</a></li>
<li><a class="reference internal" href="#setup">Setup:</a></li>
<li><a class="reference internal" href="#development-cycle">Development cycle:</a></li>
<li><a class="reference internal" href="#opening-your-work-to-other-cerebrum-devs">Opening your work to other cerebrum devs:</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/doc/devel/arch-notes.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">Cerebrum 0.9.16 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, University of Oslo.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>